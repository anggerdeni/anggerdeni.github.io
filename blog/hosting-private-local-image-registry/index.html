<!DOCTYPE html><html lang="en" class="font-sans"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><!-- Google Font --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Geist:wght@100..900&family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet"><!-- Meta --><meta name="description" content="Setting up local and private image registry for homelab environment"><meta property="title" content="Hosting Private Local Image Registry"><meta name="keywords" content="Novian Deny,Novian Deny Cahyo Aji, personal site, developer, portfolio, blog, projects, devops, infrastructure engineer, SRE"><meta name="author" content="Novian Deny"><meta name="robots" content="index, follow"><meta name="generator" content="Astro v5.1.1"><!-- OG Meta --><meta property="og:type" content="website"><meta name="og:description" content="Setting up local and private image registry for homelab environment"><meta property="og:title" content="Hosting Private Local Image Registry"><title>Hosting Private Local Image Registry</title><link rel="stylesheet" href="/_astro/about.B3NjYZ_r.css">
<style>[data-astro-image]{width:100%;height:auto;-o-object-fit:var(--fit);object-fit:var(--fit);-o-object-position:var(--pos);object-position:var(--pos);aspect-ratio:var(--w) / var(--h)}[data-astro-image=responsive]{max-width:calc(var(--w) * 1px);max-height:calc(var(--h) * 1px)}[data-astro-image=fixed]{width:calc(var(--w) * 1px);height:calc(var(--h) * 1px)}
</style></head> <body class="m-auto w-full h-screen max-w-3xl px-4 py-4 bg-charcoal text-light font-geist text-lg"> <header class="mb-20 font-ubuntu-mono"> <nav> <div class="flex items-center justify-center md:justify-between"> <div class="hidden md:block"> <a class="flex space-x-1 text-sand text-xl" href="/"> <span class="underline text-base/6">></span> <span class="italic">novian.dev</span> </a> </div> <ul class="flex items-center w-auto py-0 text-xl"> <li class="text-center my-0 mx-2"> <a class="hover:text-sand duration-200 " href="/">
Home
</a> </li> <li class="text-center my-0 mx-2"> <a class="hover:text-sand duration-200 underline underline-offset-8 text-sand" href="/blog">
Blog
</a> </li> <!-- <li class="text-center my-0 mx-2"> --> <!--     <a --> <!--         class={`hover:text-sand duration-200 ${route == "project" ? "underline underline-offset-8 text-sand" : ""}`} --> <!--         href="/project" --> <!--     > --> <!--         Project --> <!--     </a> --> <!-- </li> --> <li class="text-center my-0 mx-2"> <a class="hover:text-sand duration-200 " href="/cheatsheet">
Cheatsheet
</a> </li> <li class="text-center my-0 mx-2"> <a class="hover:text-sand duration-200 " href="/about">
About
</a> </li> </ul> </div> </nav> </header> <div class="m-auto max-w-4xl">  <div class="flex flex-col items-center text-center my-10"> <h1 class="text-4xl mb-1 text-sand">Hosting Private Local Image Registry</h1> <p class="text-sm text-gray-400"> 26 Feb 25 </p> </div> <div class="flex flex-col items-center"> <div class="text-light text-base prose dark:prose-invert prose-a:font-normal prose-a:text-light prose-a:underline prose-a:decoration-sand prose-a:underline-offset-4 hover:prose-a:text-cream 
    prose-h1:font-bold prose-h1:text-xl
    prose-h2:font-bold prose-h2:text-2xl prose-h2:text-sand
    prose-h3:font-bold prose-h3:text-lg
    prose-img:rounded-xl">  <p>One of the first problems I encountered when setting up my <a href="https://novian.dev/blog/running-kubernetes-cluster-for-less-than-5" rel="nofollow" target="_blank">kubernetes cluster</a> is where should I store my container images. Surely I don’t want to host it on a remote public / private registry because:</p>
<ol>
<li>Most of it will just be my personal fun project but it may still contain sensitive information</li>
<li>The idea that I have to download from the internet an image that was built locally from inside my homelab environment is just stupid</li>
<li>Bandwidth consideration, pulling image from internet would take some of my bandwidth and if it happens often it would destroy my precious doom-scrolling time</li>
</ol>
<p>I’ve heard about <a href="https://goharbor.io/" rel="nofollow" target="_blank">harbor</a> and <a href="https://jfrog.com/" rel="nofollow" target="_blank">jfrog</a> but upon looking it up again I found that those are too complicated for my use case. Instead I settled on using <a href="https://distribution.github.io/distribution/" rel="nofollow" target="_blank">distribution</a> (or is it called registry?) and running it on a VM using docker.</p>
<p>Seems simple enough right? Not so much apparently. See, the thing about running a registry is somehow all the client (docker, containerd in kubernetes cluster) connecting to the registry needs to use TLS. Even for the ones running completely locally. This means I need to do some additional steps:</p>
<ol>
<li>Generate SSL certificate for the registry</li>
<li>Make sure the clients are connecting to the registry via domain name with a valid TLS certificate</li>
<li>Configure all clients to trust the certificate</li>
</ol>
<h2 id="running-the-registry">Running The Registry</h2>
<p>As mentioned before, I am running the registry locally and don’t want to expose it via public domain. In this case I am using <code>registry.box</code> domain, so I can’t use trusted certificate like <code>Let's Encrypt</code> here. So I just generated my self-signed certificate using <code>openssl</code>. To generate the certificate for that domain, I use the following command</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.7tiip.css"><script type="module" src="/_astro/ec.8zarh.js"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sh" class="wrap" style="--ecMaxLine:150ch"><code><div class="ec-line"><div class="code"><span style="--0:#8AADF4;--0fs:italic">openssl</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">req</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">-newkey</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">rsa:4096</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">-nodes</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">-sha256</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">-keyout</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">certs/domain.key</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">-addext</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"subjectAltName = DNS:registry.box"</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">-x509</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">-days</span><span style="--0:#CAD3F5"> </span><span style="--0:#F5A97F">365</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">-out</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">certs/domain.crt</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="openssl req -newkey rsa:4096 -nodes -sha256 -keyout certs/domain.key -addext &#x22;subjectAltName = DNS:registry.box&#x22; -x509 -days 365 -out certs/domain.crt"><div></div></button></div></figure></div>
<p>For actually running the registry, I use docker. BUT!!! the one responsible for running the docker command is my ansible script (lol). I really don’t know whether this is a good idea, but at the time I don’t have any simpler solution. Below is the script that I use</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="yaml" class="wrap" style="--ecMaxLine:54ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F5BDE6">---</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#979EBA">-</span><span style="--0:#CAD3F5"> </span><span style="--0:#8AADF4">name</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">Create registry configuration from template</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">  </span><span style="--0:#8AADF4">ansible.builtin.template</span><span style="--0:#8BD5CA">:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">src</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">htpasswd.j2</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">dest</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">/opt/htpasswd</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">mode</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">'0644'</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#979EBA">-</span><span style="--0:#CAD3F5"> </span><span style="--0:#8AADF4">name</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">Creates cert dir</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">  </span><span style="--0:#8AADF4">ansible.builtin.file</span><span style="--0:#8BD5CA">:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">path</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">/opt/certs</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">state</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">directory</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#979EBA">-</span><span style="--0:#CAD3F5"> </span><span style="--0:#8AADF4">name</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">Copy SSL crt for registry.box</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">  </span><span style="--0:#8AADF4">ansible.builtin.copy</span><span style="--0:#8BD5CA">:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">content</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"{{ domain_crt }}"</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">dest</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"/opt/certs/domain.crt"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#979EBA">-</span><span style="--0:#CAD3F5"> </span><span style="--0:#8AADF4">name</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">Copy SSL key for registry.box</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">  </span><span style="--0:#8AADF4">ansible.builtin.copy</span><span style="--0:#8BD5CA">:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">content</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"{{ domain_key }}"</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">dest</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"/opt/certs/domain.key"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span style="--0:#979EBA">-</span><span style="--0:#CAD3F5"> </span><span style="--0:#8AADF4">name</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">Run registry</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">  </span><span style="--0:#8AADF4">ansible.builtin.docker_container</span><span style="--0:#8BD5CA">:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">name</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">registry</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">image</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">registry:2</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">state</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">started</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">restart_policy</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">always</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">ports</span><span style="--0:#8BD5CA">:</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">      </span><span style="--0:#979EBA">-</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"443:443"</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">volumes</span><span style="--0:#8BD5CA">:</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent">      </span><span style="--0:#979EBA">-</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"/opt/htpasswd:/opt/htpasswd"</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent">      </span><span style="--0:#979EBA">-</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"/opt/certs:/certs"</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent">      </span><span style="--0:#979EBA">-</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"/mnt/registry:/var/lib/registry"</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">env</span><span style="--0:#8BD5CA">:</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">REGISTRY_AUTH</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"htpasswd"</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">REGISTRY_AUTH_HTPASSWD_REALM</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"Registry Realm"</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">REGISTRY_AUTH_HTPASSWD_PATH</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"/opt/htpasswd"</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">REGISTRY_HTTP_ADDR</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">0.0.0.0:443</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">REGISTRY_HTTP_TLS_CERTIFICATE</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">/certs/domain.crt</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">REGISTRY_HTTP_TLS_KEY</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">/certs/domain.key</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="---- name: Create registry configuration from template  ansible.builtin.template:    src: htpasswd.j2    dest: /opt/htpasswd    mode: &#x27;0644&#x27;- name: Creates cert dir  ansible.builtin.file:    path: /opt/certs    state: directory- name: Copy SSL crt for registry.box  ansible.builtin.copy:    content: &#x22;{{ domain_crt }}&#x22;    dest: &#x22;/opt/certs/domain.crt&#x22;- name: Copy SSL key for registry.box  ansible.builtin.copy:    content: &#x22;{{ domain_key }}&#x22;    dest: &#x22;/opt/certs/domain.key&#x22;- name: Run registry  ansible.builtin.docker_container:    name: registry    image: registry:2    state: started    restart_policy: always    ports:      - &#x22;443:443&#x22;    volumes:      - &#x22;/opt/htpasswd:/opt/htpasswd&#x22;      - &#x22;/opt/certs:/certs&#x22;      - &#x22;/mnt/registry:/var/lib/registry&#x22;    env:      REGISTRY_AUTH: &#x22;htpasswd&#x22;      REGISTRY_AUTH_HTPASSWD_REALM: &#x22;Registry Realm&#x22;      REGISTRY_AUTH_HTPASSWD_PATH: &#x22;/opt/htpasswd&#x22;      REGISTRY_HTTP_ADDR: 0.0.0.0:443      REGISTRY_HTTP_TLS_CERTIFICATE: /certs/domain.crt      REGISTRY_HTTP_TLS_KEY: /certs/domain.key"><div></div></button></div></figure></div>
<p>After that I only need to setup DNS A Record from my DNS server (in this case pihole instances) to point the domain <code>registry.box</code> to the IP of that VM.</p>
<h2 id="trust-isnt-earned-its-enforced">Trust Isn’t Earned, It’s Enforced</h2>
<p>The thing about self signed certificate is, of course no one trust it out of the box. In general, we can mark that a certificate is trusted in a Debian based OS by putting the <code>crt</code> file inside <code>/usr/local/share/ca-certificates</code> directory. In my use case there are two system which directly communicate with image registry:</p>
<ul>
<li>Kubernetes cluster to pull container images; and</li>
<li>Github action runner pod to push image of my built applications</li>
</ul>
<p>For the Kubernetes use case, as far as I’m aware, I have two options:</p>
<ol>
<li>Manually (?) puts the certificate file in each nodes</li>
<li>Use DaemonSet to do just that as pointed in this <a href="https://github.com/coreos/tectonic-docs/blob/master/Documentation/admin/add-registry-cert.md" rel="nofollow" target="_blank">docs</a></li>
</ol>
<p>I chose the first option to manually add the certificate into each and every nodes. Of course I don’t actually do it manually, I utilized my existing ansible script for installing and/or upgrading k3s cluster as follow:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="yaml" class="wrap" style="--ecMaxLine:61ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#CAD3F5">...</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#979EBA">-</span><span style="--0:#CAD3F5"> </span><span style="--0:#8AADF4">name</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">Copy SSL crt for registry.box</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">  </span><span style="--0:#8AADF4">ansible.builtin.copy</span><span style="--0:#8BD5CA">:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">content</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"{{ domain_crt }}"</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">dest</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"/usr/local/share/ca-certificates/registry.box.crt"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#979EBA">-</span><span style="--0:#CAD3F5"> </span><span style="--0:#8AADF4">name</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">Update system's certificate store</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">  </span><span style="--0:#8AADF4">ansible.builtin.shell</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">update-ca-certificates</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#CAD3F5">...</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="...- name: Copy SSL crt for registry.box  ansible.builtin.copy:    content: &#x22;{{ domain_crt }}&#x22;    dest: &#x22;/usr/local/share/ca-certificates/registry.box.crt&#x22;- name: Update system&#x27;s certificate store  ansible.builtin.shell: update-ca-certificates..."><div></div></button></div></figure></div>
<p>The reasoning behind this decision are:</p>
<ol>
<li>Using DaemonSet means it will unavoidably uses some amount of resources from the node to run the DaemonSet pods</li>
<li>I’m not aware of this option until after I finished setting up my kubernetes cluster</li>
</ol>
<h2 id="ui--dashboard">UI / Dashboard</h2>
<p>Upon writing this post, I was reminded that my registry is missing one key component and that is UI / dashboard. Up to this point I haven’t had the need to manage and monitor my registry but that will likely change over time. I will eventually need to do garbage collecting (removing unused images). And having the ability to see what’s available and not in my registry easily is a nice feature to have. In order to do so, I do some googling and found some options:</p>
<ul>
<li><a href="http://port.us.org/" rel="nofollow" target="_blank">port.us.org</a></li>
<li><a href="https://github.com/Joxit/docker-registry-ui" rel="nofollow" target="_blank">github.com/Joxit/docker-registry-ui</a></li>
</ul>
<p>I settled on using the second option due to its simplicity and straightforwardness. So I modified my ansible script as follow:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="yaml" class="wrap" style="--ecMaxLine:96ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#CAD3F5">...</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#979EBA">-</span><span style="--0:#CAD3F5"> </span><span style="--0:#8AADF4">name</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">Create Docker network</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">  </span><span style="--0:#8AADF4">ansible.builtin.docker_network</span><span style="--0:#8BD5CA">:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">name</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">registry_network</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">state</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">present</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#979EBA">-</span><span style="--0:#CAD3F5"> </span><span style="--0:#8AADF4">name</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">Run registry</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">  </span><span style="--0:#8AADF4">ansible.builtin.docker_container</span><span style="--0:#8BD5CA">:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">name</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">registry</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">image</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">registry:2</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">state</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">started</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">restart_policy</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">always</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">networks</span><span style="--0:#8BD5CA">:</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">      </span><span style="--0:#979EBA">-</span><span style="--0:#CAD3F5"> </span><span style="--0:#8AADF4">name</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">registry_network</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">ports</span><span style="--0:#8BD5CA">:</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">      </span><span style="--0:#979EBA">-</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"443:443"</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">volumes</span><span style="--0:#8BD5CA">:</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">      </span><span style="--0:#979EBA">-</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"/opt/htpasswd:/opt/htpasswd"</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">      </span><span style="--0:#979EBA">-</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"/opt/certs:/certs"</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">      </span><span style="--0:#979EBA">-</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"/mnt/registry:/var/lib/registry"</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">env</span><span style="--0:#8BD5CA">:</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">REGISTRY_AUTH</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"htpasswd"</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">REGISTRY_AUTH_HTPASSWD_REALM</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"Registry Realm"</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">REGISTRY_AUTH_HTPASSWD_PATH</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"/opt/htpasswd"</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">REGISTRY_HTTP_ADDR</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">0.0.0.0:443</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">REGISTRY_HTTP_TLS_CERTIFICATE</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">/certs/domain.crt</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">REGISTRY_HTTP_TLS_KEY</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">/certs/domain.key</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">REGISTRY_HTTP_HEADERS_Access-Control-Allow-Origin</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"[http://registry-ui.box]"</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">REGISTRY_HTTP_HEADERS_Access-Control-Allow-Methods</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"[HEAD,GET,OPTIONS,DELETE]"</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">REGISTRY_HTTP_HEADERS_Access-Control-Allow-Credentials</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"[true]"</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">REGISTRY_HTTP_HEADERS_Access-Control-Allow-Headers</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"[Authorization,Accept,Cache-Control]"</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">REGISTRY_HTTP_HEADERS_Access-Control-Expose-Headers</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"[Docker-Content-Digest]"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span style="--0:#979EBA">-</span><span style="--0:#CAD3F5"> </span><span style="--0:#8AADF4">name</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">Run registry UI</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">  </span><span style="--0:#8AADF4">ansible.builtin.docker_container</span><span style="--0:#8BD5CA">:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">name</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">registry-ui</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">image</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">joxit/docker-registry-ui:main</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">state</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">started</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">restart_policy</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">always</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">networks</span><span style="--0:#8BD5CA">:</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent">      </span><span style="--0:#979EBA">-</span><span style="--0:#CAD3F5"> </span><span style="--0:#8AADF4">name</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">registry_network</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">ports</span><span style="--0:#8BD5CA">:</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent">      </span><span style="--0:#979EBA">-</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"8080:80"</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent">    </span><span style="--0:#8AADF4">env</span><span style="--0:#8BD5CA">:</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">SINGLE_REGISTRY</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"true"</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">REGISTRY_TITLE</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">Docker Registry UI</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">DELETE_IMAGES</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"true"</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">SHOW_CONTENT_DIGEST</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"true"</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">NGINX_PROXY_PASS_URL</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">https://registry</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">SHOW_CATALOG_NB_TAGS</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"true"</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">CATALOG_MIN_BRANCHES</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"1"</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">CATALOG_MAX_BRANCHES</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"1"</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">TAGLIST_PAGE_SIZE</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"100"</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">REGISTRY_SECURED</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"true"</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span class="indent">      </span><span style="--0:#8AADF4">CATALOG_ELEMENTS_LIMIT</span><span style="--0:#8BD5CA">:</span><span style="--0:#CAD3F5"> </span><span style="--0:#A6DA95">"1000"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span style="--0:#CAD3F5">...</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="...- name: Create Docker network  ansible.builtin.docker_network:    name: registry_network    state: present- name: Run registry  ansible.builtin.docker_container:    name: registry    image: registry:2    state: started    restart_policy: always    networks:      - name: registry_network    ports:      - &#x22;443:443&#x22;    volumes:      - &#x22;/opt/htpasswd:/opt/htpasswd&#x22;      - &#x22;/opt/certs:/certs&#x22;      - &#x22;/mnt/registry:/var/lib/registry&#x22;    env:      REGISTRY_AUTH: &#x22;htpasswd&#x22;      REGISTRY_AUTH_HTPASSWD_REALM: &#x22;Registry Realm&#x22;      REGISTRY_AUTH_HTPASSWD_PATH: &#x22;/opt/htpasswd&#x22;      REGISTRY_HTTP_ADDR: 0.0.0.0:443      REGISTRY_HTTP_TLS_CERTIFICATE: /certs/domain.crt      REGISTRY_HTTP_TLS_KEY: /certs/domain.key      REGISTRY_HTTP_HEADERS_Access-Control-Allow-Origin: &#x22;[http://registry-ui.box]&#x22;      REGISTRY_HTTP_HEADERS_Access-Control-Allow-Methods: &#x22;[HEAD,GET,OPTIONS,DELETE]&#x22;      REGISTRY_HTTP_HEADERS_Access-Control-Allow-Credentials: &#x22;[true]&#x22;      REGISTRY_HTTP_HEADERS_Access-Control-Allow-Headers: &#x22;[Authorization,Accept,Cache-Control]&#x22;      REGISTRY_HTTP_HEADERS_Access-Control-Expose-Headers: &#x22;[Docker-Content-Digest]&#x22;- name: Run registry UI  ansible.builtin.docker_container:    name: registry-ui    image: joxit/docker-registry-ui:main    state: started    restart_policy: always    networks:      - name: registry_network    ports:      - &#x22;8080:80&#x22;    env:      SINGLE_REGISTRY: &#x22;true&#x22;      REGISTRY_TITLE: Docker Registry UI      DELETE_IMAGES: &#x22;true&#x22;      SHOW_CONTENT_DIGEST: &#x22;true&#x22;      NGINX_PROXY_PASS_URL: https://registry      SHOW_CATALOG_NB_TAGS: &#x22;true&#x22;      CATALOG_MIN_BRANCHES: &#x22;1&#x22;      CATALOG_MAX_BRANCHES: &#x22;1&#x22;      TAGLIST_PAGE_SIZE: &#x22;100&#x22;      REGISTRY_SECURED: &#x22;true&#x22;      CATALOG_ELEMENTS_LIMIT: &#x22;1000&#x22;..."><div></div></button></div></figure></div>
<h2 id="future-work">Future Work</h2>
<ol>
<li>The smart me from the past thinks that 365 days of certificate validity is a good enough number. Well, it is not, one day I’ll forget about this and my system breaks because the SSL certificate is no longer valid. I need a way to automate this</li>
<li>Monitoring and alerting. I have node exporter installed on all of my VMs so I can use that to monitor CPU, memory, and storage usage. But still no alerting and container specific metrics (<a href="https://github.com/google/cadvisor" rel="nofollow" target="_blank">cadvisor</a> might be a good fit for this)</li>
<li>Security scanning</li>
</ol>  </div> </div>  </div> <footer> <hr class="h-px my-8 bg-cream border-0"> <div class="container mx-auto text-center"> <div class="flex justify-center space-x-6"> <a href="https://www.linkedin.com/in/noviandeny/" target="_blank" class="text-light hover:text-blue-500"> <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 50 50" fill="#FFF0DC"> <path d="M41,4H9C6.24,4,4,6.24,4,9v32c0,2.76,2.24,5,5,5h32c2.76,0,5-2.24,5-5V9C46,6.24,43.76,4,41,4z M17,20v19h-6V20H17z M11,14.47c0-1.4,1.2-2.47,3-2.47s2.93,1.07,3,2.47c0,1.4-1.12,2.53-3,2.53C12.2,17,11,15.87,11,14.47z M39,39h-6c0,0,0-9.26,0-10 c0-2-1-4-3.5-4.04h-0.08C27,24.96,26,27.02,26,29c0,0.91,0,10,0,10h-6V20h6v2.56c0,0,1.93-2.56,5.81-2.56 c3.97,0,7.19,2.73,7.19,8.26V39z"></path> </svg> </a> <a href="https://github.com/anggerdeni/" target="_blank" class="text-light hover:text-gray-700"> <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 50 50" fill="#FFF0DC"> <path d="M17.791,46.836C18.502,46.53,19,45.823,19,45v-5.4c0-0.197,0.016-0.402,0.041-0.61C19.027,38.994,19.014,38.997,19,39 c0,0-3,0-3.6,0c-1.5,0-2.8-0.6-3.4-1.8c-0.7-1.3-1-3.5-2.8-4.7C8.9,32.3,9.1,32,9.7,32c0.6,0.1,1.9,0.9,2.7,2c0.9,1.1,1.8,2,3.4,2 c2.487,0,3.82-0.125,4.622-0.555C21.356,34.056,22.649,33,24,33v-0.025c-5.668-0.182-9.289-2.066-10.975-4.975 c-3.665,0.042-6.856,0.405-8.677,0.707c-0.058-0.327-0.108-0.656-0.151-0.987c1.797-0.296,4.843-0.647,8.345-0.714 c-0.112-0.276-0.209-0.559-0.291-0.849c-3.511-0.178-6.541-0.039-8.187,0.097c-0.02-0.332-0.047-0.663-0.051-0.999 c1.649-0.135,4.597-0.27,8.018-0.111c-0.079-0.5-0.13-1.011-0.13-1.543c0-1.7,0.6-3.5,1.7-5c-0.5-1.7-1.2-5.3,0.2-6.6 c2.7,0,4.6,1.3,5.5,2.1C21,13.4,22.9,13,25,13s4,0.4,5.6,1.1c0.9-0.8,2.8-2.1,5.5-2.1c1.5,1.4,0.7,5,0.2,6.6c1.1,1.5,1.7,3.2,1.6,5 c0,0.484-0.045,0.951-0.11,1.409c3.499-0.172,6.527-0.034,8.204,0.102c-0.002,0.337-0.033,0.666-0.051,0.999 c-1.671-0.138-4.775-0.28-8.359-0.089c-0.089,0.336-0.197,0.663-0.325,0.98c3.546,0.046,6.665,0.389,8.548,0.689 c-0.043,0.332-0.093,0.661-0.151,0.987c-1.912-0.306-5.171-0.664-8.879-0.682C35.112,30.873,31.557,32.75,26,32.969V33 c2.6,0,5,3.9,5,6.6V45c0,0.823,0.498,1.53,1.209,1.836C41.37,43.804,48,35.164,48,25C48,12.318,37.683,2,25,2S2,12.318,2,25 C2,35.164,8.63,43.804,17.791,46.836z"></path> </svg> </a> <a href="mailto:hello@novian.dev" class="text-light hover:text-gray-400"> <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 50 50" fill="#FFF0DC"> <path d="M2,12c0-2.211,1.789-4,4-4h40c2.211,0,4,1.789,4,4v26c0,2.211-1.789,4-4,4H6c-2.211,0-4-1.789-4-4V12z M25,28l18-12H7L25,28z"></path> </svg> </a> </div> </div> </footer> </body></html>